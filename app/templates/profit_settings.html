{% extends "base.html" %}

{% block title %}Profit Settings{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="bi bi-gear"></i> Profit Settings</h2>
    <a href="{{ url_for('stats.profits') }}" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left"></i> Back to Profits
    </a>
</div>

<div class="row">
    <div class="col-lg-6">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-currency-dollar"></i> Material Costs</h5>
            </div>
            <div class="card-body">
                <p class="text-muted mb-4">
                    Configure the marketboard prices for materials to accurately calculate your profit margins.
                    Prices are per stack (999 units).
                </p>

                <form method="POST" action="{{ url_for('stats.profit_settings') }}">
                    <div class="mb-4">
                        <label class="form-label" for="ceruleum_price">
                            <i class="bi bi-fuel-pump text-info"></i> Ceruleum Tank Price (per stack of 999)
                        </label>
                        <div class="input-group">
                            <input type="number" class="form-control" id="ceruleum_price" name="ceruleum_price"
                                   value="{{ settings.ceruleum_price_per_stack.value }}"
                                   min="0" max="99999999" required>
                            <span class="input-group-text">gil</span>
                        </div>
                        <small class="text-muted">
                            Current: {{ "{:,.0f}".format(settings.ceruleum_price_per_stack.value|int) }} gil/stack
                            ({{ "{:.2f}".format(settings.ceruleum_price_per_stack.value|int / 999) }} gil/tank)
                        </small>
                    </div>

                    <div class="mb-4">
                        <label class="form-label" for="kit_price">
                            <i class="bi bi-wrench text-warning"></i> Repair Kit Price (per stack of 999)
                        </label>
                        <div class="input-group">
                            <input type="number" class="form-control" id="kit_price" name="kit_price"
                                   value="{{ settings.repair_kit_price_per_stack.value }}"
                                   min="0" max="99999999" required>
                            <span class="input-group-text">gil</span>
                        </div>
                        <small class="text-muted">
                            Current: {{ "{:,.0f}".format(settings.repair_kit_price_per_stack.value|int) }} gil/stack
                            ({{ "{:.2f}".format(settings.repair_kit_price_per_stack.value|int / 999) }} gil/kit)
                        </small>
                    </div>

                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-check-lg"></i> Save Settings
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="col-lg-6">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-info-circle"></i> About Profit Calculations</h5>
            </div>
            <div class="card-body">
                <h6>How profits are calculated:</h6>
                <ul>
                    <li><strong>Gross Income</strong> = Gil value of loot collected (vendor prices)</li>
                    <li><strong>Material Cost</strong> = (Ceruleum used + Repair kits used) × your configured prices</li>
                    <li><strong>Net Profit</strong> = Gross Income - Material Cost</li>
                </ul>

                <h6 class="mt-4">Material consumption estimates:</h6>
                <p class="text-muted small">
                    Material consumption per voyage is estimated based on your current fleet's average consumption rates.
                    The system calculates how much ceruleum and repair kits are used based on the routes being run.
                </p>

                <h6 class="mt-4">Trend line:</h6>
                <p class="text-muted small">
                    The trend line uses linear regression to show the general direction of your profits.
                    The R² value indicates how well the trend fits your data (closer to 1.0 = better fit).
                </p>

                <h6 class="mt-4">Projections:</h6>
                <p class="text-muted small">
                    Future projections extend the trend line forward. These are estimates based on past performance
                    and assume your fleet composition and routes remain similar.
                </p>
            </div>
        </div>
    </div>
</div>
{% endblock %}
